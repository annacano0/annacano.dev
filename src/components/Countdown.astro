---
const { final_date } = Astro.props;
const TIMESTAMP_END = final_date.getTime();
---

<div class="countdown-container">
  <header>
    <h1>Launching Soon</h1>
    <p>This is under development. Stay tuned!</p>
    <h2>Countdown to launch:</h2>
  </header>

  <section class="countdown" data-date={TIMESTAMP_END}>
    <p><span data-days>00</span> d</p>
    <p>
      <span data-hours>00</span> h
    </p>
    <p>
      <span data-minutes>00</span> m
    </p>
    <p>
      <span data-seconds>00</span> s
    </p>
  </section>

  <p class="text-secondary">
    Check the progress of the code on the <a
      href="https://github.com/annacano0/portfolio"
      target="_blank">repository</a
    >
  </p>
</div>

<script>
  const SECOND = 1000;
  const MINUTE = SECOND * 60;
  const HOUR = MINUTE * 60;
  const DAY = HOUR * 24;

  function init() {
    const $countdown = document.querySelector("[data-date]");
    if (!$countdown) return;

    const $days = $countdown.querySelector("[data-days]");
    const $hours = $countdown.querySelector("[data-hours]");
    const $minutes = $countdown.querySelector("[data-minutes]");
    const $seconds = $countdown.querySelector("[data-seconds]");

    const timestamp = $countdown.getAttribute("data-date");
    const date = new Date(+timestamp!).getTime();

    const formatTime = (time: number) => {
      return Math.floor(+time).toString().padStart(2, "0");
    };

    function updateCountdown() {
      //get the difference of ms between the first and second date
      const now = Date.now();
      const diff = date - now;

      //update days
      $days instanceof HTMLElement &&
        ($days.innerText = formatTime(diff / DAY));

      //update hours
      $hours instanceof HTMLElement &&
        ($hours.innerText = formatTime((diff % DAY) / HOUR));

      //update minutes
      $minutes instanceof HTMLElement &&
        ($minutes.innerText = formatTime((diff % HOUR) / MINUTE));

      //update seconds
      $seconds instanceof HTMLElement &&
        ($seconds.innerText = formatTime((diff % MINUTE) / SECOND));
    }
    setInterval(updateCountdown, SECOND);
  }
  init();
</script>

<style>
  .countdown-container header {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .countdown {
    color: var(--highlight);
    display: flex;
    flex-direction: row;
    justify-content: center;
    gap: 1rem;
    background-color: var(--accent);
    padding: 1rem;
    border: 0.2rem solid var(--highlight);
    margin: 1em 0em;
  }

  .text-secondary {
    text-align: center;
  }
</style>
